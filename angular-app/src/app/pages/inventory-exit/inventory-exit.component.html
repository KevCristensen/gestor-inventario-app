<!-- Contenedor principal con animación de entrada -->
<div class="text-white" style="animation: fade-in-up 0.7s ease-out forwards;">
    <h1 class="text-3xl font-bold mb-6">Registrar Salida de Inventario</h1>
  
    <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 p-6 rounded-xl mb-6">
      <label for="notes" class="block mb-2 text-sm font-medium text-gray-300">Motivo de la Salida (Ej: Consumo diario, Despacho, etc.)</label>
      <input type="text" id="notes" [(ngModel)]="exitData.notes" name="notes" class="w-full bg-gray-700/80 p-2.5 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all duration-300">
    </div>
  
    <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 p-6 rounded-xl mb-6">
      <label for="barcode-scanner" class="block mb-2 text-lg font-medium text-gray-300">Escanear Producto a Retirar</label>
      <input 
        type="text" 
        id="barcode-scanner"
        #barcodeInput
        placeholder="Esperando código..."
        (keyup.enter)="onBarcodeScanned(barcodeInput.value); barcodeInput.value = ''"
        class="w-full p-4 text-2xl bg-gray-900/50 rounded-lg border-2 border-gray-600 focus:ring-4 focus:ring-blue-500/50 focus:border-blue-500 focus:outline-none transition-all duration-300"
      >
    </div>
  
    <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 p-6 rounded-xl">
      <h2 class="text-2xl font-bold mb-4">Items a Retirar</h2>
      <table class="w-full text-left">
        <thead class="border-b-2 border-gray-700">
          <tr class="text-sm text-gray-400">
            <th class="p-2 w-3/5">Producto</th>
            <th class="p-2 w-1/5">Cantidad</th>
            <th class="p-2 w-1/5 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for(item of exitData.items; track item.product_id) {
            <tr class="border-b border-gray-700/50 hover:bg-gray-700/40 transition-colors duration-200">
              <td class="p-2">{{ item.name }}</td>
              <td class="p-2"><input type="number" [(ngModel)]="item.quantity" class="w-24 bg-gray-700/80 p-2 rounded-lg border border-gray-600 focus:ring-blue-500 focus:outline-none"></td>
              <td class="p-2 text-center"><button (click)="removeItem(item.product_id)" class="text-red-400 hover:text-red-300 transition-colors transform hover:scale-110">Quitar</button></td>
            </tr>
          } @empty {
            <tr><td colspan="3" class="p-8 text-center text-gray-500">Aún no se han escaneado productos.</td></tr>
          }
        </tbody>
      </table>
      <div class="flex justify-end mt-6 space-x-4">
        <button 
          (click)="printReceipt()" 
          [disabled]="exitData.items.length === 0 || isSaving"
          class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50 transition-all transform hover:scale-105">
          Imprimir Comprobante
        </button>
      
        <button 
          (click)="saveExit()" 
          [disabled]="exitData.items.length === 0 || isSaving" 
          class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 px-6 rounded-lg disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center min-w-[210px] transition-all transform hover:scale-105">
          @if (isSaving) {
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Confirmando...</span>
          } @else {
            <span>Confirmar Salida</span>
          }
        </button>
      </div>
    </div>
  </div>