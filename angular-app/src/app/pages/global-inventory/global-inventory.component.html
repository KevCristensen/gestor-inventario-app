<!-- Contenedor principal con animación de entrada -->
<div class="text-white" style="animation: fade-in-up 0.7s ease-out forwards;">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Inventario Global</h1>

    <div class="w-1/3 relative">
      <span class="absolute inset-y-0 left-0 flex items-center pl-3">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
      </span>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Buscar por nombre o código de barras..."
        class="w-full bg-gray-700/80 p-3 pl-10 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none transition-all duration-300"
      >
    </div>
  </div>
  
  <p class="text-gray-400 mb-6 text-sm">
    Vista consolidada del stock de cada producto en todas las bodegas.
  </p>

  @if (pivotedInventory.length > 0) {
    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl shadow-lg p-6 border border-gray-700/50 overflow-x-auto">
      <table class="w-full text-left">
        <thead class="border-b-2 border-gray-700">
          <tr class="text-sm text-gray-400">
            <th class="p-4 sticky left-0 bg-transparent z-10" style="box-shadow: 5px 0 15px -5px rgba(0,0,0,0.3);">Producto</th>
            <th class="p-4">Código de Barras</th>
            @for (collegeName of collegeHeaders; track collegeName) {
              <th class="p-4 text-center whitespace-nowrap">{{ collegeName }}</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (product of pivotedInventory; track product.barcode) {
            <tr class="border-b border-gray-700/50 hover:bg-gray-700/50 transition-colors duration-200 group">
              <td class="p-4 font-semibold sticky left-0 bg-transparent group-hover:bg-gray-700/50 transition-colors duration-200" style="box-shadow: 5px 0 15px -5px rgba(0,0,0,0.3);">{{ product.productName }}</td>
              <td class="p-4 text-gray-400 font-mono">{{ product.barcode }}</td>
              @for (collegeName of collegeHeaders; track collegeName) {
                <td class="p-4 text-center font-mono text-lg"
                    [ngClass]="{
                      'text-red-400 font-bold': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock <= product.stocksByCollege[collegeName].min_stock && product.stocksByCollege[collegeName].stock > 0,
                      'text-green-400': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock > product.stocksByCollege[collegeName].min_stock,
                      'text-yellow-400': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock === 0
                    }">
                  {{ product.stocksByCollege[collegeName]?.stock ?? '—' }}
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="bg-gray-800/50 rounded-xl shadow p-8 text-center text-gray-500 border border-dashed border-gray-700">
      No hay movimientos de inventario registrados.
    </div>
  }
</div>