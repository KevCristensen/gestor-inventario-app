<div class="text-white">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Inventario Global</h1>

    <div class="w-1/3">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Buscar por nombre de producto..."
        class="w-full bg-gray-700 p-2.5 rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition"
      >
    </div>
  </div>
  
  <p class="text-gray-400 mb-6">
    Vista consolidada del stock de cada producto en todas las bodegas.
  </p>

  @if (pivotedInventory.length > 0) {
    <div class="bg-gray-800 rounded-lg shadow p-6 overflow-x-auto">
      <table class="w-full text-left">
        <thead class="border-b border-gray-600">
          <tr>
            <th class="p-4 sticky left-0 bg-gray-800 z-10">Producto</th>
            <th class="p-4">CÃ³digo de Barras</th>
            @for (collegeName of collegeHeaders; track collegeName) {
              <th class="p-4 text-center">{{ collegeName }}</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (product of pivotedInventory; track product.productName) {
            <tr class="border-b border-gray-700">
              <td class="p-4 font-semibold sticky left-0 bg-gray-800 z-10">{{ product.productName }}</td>
              <td class="p-4 text-gray-400 font-mono">{{ product.barcode }}</td>
              @for (collegeName of collegeHeaders; track collegeName) {
                <td class="p-4 text-center font-mono"
                    [ngClass]="{
                      'text-red-500 font-bold': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock <= product.stocksByCollege[collegeName].min_stock && product.stocksByCollege[collegeName].stock > 0,
                      'text-green-400': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock > product.stocksByCollege[collegeName].min_stock,
                      'text-white': product.stocksByCollege[collegeName] && product.stocksByCollege[collegeName].stock === 0
                    }">
                  {{ product.stocksByCollege[collegeName]?.stock ?? '-' }}
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="bg-gray-800 rounded-lg shadow p-8 text-center text-gray-500">
      No hay movimientos de inventario registrados.
    </div>
  }
</div>