<div class="text-white">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">Inventario Global</h1>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
            <label for="entity-filter" class="text-sm text-gray-400">Filtrar por Bodega</label>
            <select id="entity-filter" 
                    [(ngModel)]="selectedEntityId" 
                    (change)="onFilterChange()"
                    class="w-full mt-1 bg-gray-700 p-2.5 rounded-lg border border-gray-600">
                <option value="all">Todas las Bodegas</option>
                @for (entity of entities; track entity.id) {
                <option [value]="entity.id">{{ entity.name }}</option>
                }
            </select>
        </div>
      </div>
      <div>
        <label for="product-search" class="text-sm text-gray-400">Buscar por Nombre de Producto</label>
        <input type="text" id="product-search" 
               [(ngModel)]="searchTerm" 
               (input)="onFilterChange()"
               placeholder="Ej: Leche..."
               class="w-full mt-1 bg-gray-700 p-2.5 rounded-lg border border-gray-600">
      </div>
    </div>

    <p class="text-gray-400 mb-6">
      Vista consolidada del stock de cada producto en todas las bodegas.
    </p>
  
    <div class="space-y-6">
      @for (productName of getObjectKeys(groupedInventory); track productName) {
        <div class="bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-4">{{ productName }}</h2>
          <table class="w-full text-left">
            <thead class="border-b border-gray-600">
                <tr>
                  <th class="p-2">Bodega (Colegio)</th> <th class="p-2">Stock Actual</th>
                </tr>
              </thead>
              <tbody>
                @for (item of groupedInventory[productName]; track item.entity_id) {
                  <tr class="border-b border-gray-700">
                    <td class="p-2">{{ item.entity_name }}</td> <td class="p-2 font-mono">{{ item.stock }}</td>
                  </tr>
                }
              </tbody>
          </table>
        </div>
      } @empty {
        <div class="bg-gray-800 rounded-lg shadow p-8 text-center text-gray-500">
          No hay movimientos de inventario registrados.
        </div>
      }
    </div>
  </div>